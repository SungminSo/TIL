# 빠르게 성장하는 스타트업의 DW

## DB Review
- 토스에서는 각 silo의 서버 개발자가 DB 테이블 생성 또는 변경할 경우 DBA의 리뷰를 거치게 됨
- DBA는 컴플라이언스과 데이터모델, 성능과 안정성, 운영 효율성 관점에서 리뷰 진행
	 - 컴플라이언스 준수 확인(개인정보, 암호화, 권한 관리 등)
	 - 성능과 운영효율 고려한 인덱스 및 파티션 설계
	 - 기본적인 용어 표준(reg\_ts? regts? create\_time?...)
	 - 명확한 데이터 모델(PK, FK, 코멘트) - 필요할 경우 데이터 엔지니어도 리뷰에 참여
	 	- 명확한 데이터모델 및 최소한의 표준 준수는 불필요한 커뮤니케이션 비용을 줄이고 효율적인 데이터 활용에 기여 
     
## 디멘젼 테이블
- 차원에 대한 정의 테이블 -> 자동화를 위한 선제 조건
- 주요 행위나 서비스에 대한 정의
- 각종 수수료 및 매출 계약정보 등
- case when이나 if then else 같은 구문으로 하드코딩 되어있다면 당장은 번거로워 보여도 디멘젼 테이블로 정의하는 것이 장기적으로는 훨씬 효율적
- 하지만 제대로 된 관리 툴이 없으면 변경이 생길때마다 굉장히 번거로울 수 있음
	- 구글 스프레드시트로 관리하는 방법
		- RDS와 데이터를 동기화하는 프로그램 작성
		- 데이터 시트와 DB 동기화 설정 시트 생성
		- 데이터 시트는 DB에 저장될 디멘젼테이블과 동일한 형태로 데이터를 입력하는 시트
		- DB 동기화 설정 시트는 구글시트의 필드 정보와 DB와의 맵핑 정보를 저장하는 시트
		- DB 동기화 설정를 기반으로 DB에 insert/delete 처리
	- 여유가 된다면 제대로 된 시스템을 만드는게 좋음(ex. 토스의 table centre)
		- 하지만 가장 빠르고 효율적으로 하기에는 시스템 구축은 비효율적일 수 있음
		- 쉬운 방법으로 빠르게 대처한 다음 적절하게 대체하는 방법을 추천  
     
## ODS 설계 및 운영
- ODS(Opeational Data Store) : 중간가공단계의 데이터들의 저장소
- 운영 시스템의 복잡한 형태를 단순화하거나 표준에 맞지 않는 부분 전처리, 중간집계형태로 summary된 형태로 구성될 수 있음
- ex. Activation(이용자 첫 방문 및 경험) 관련 지표 집계를 자동화한 사례
	- AARRR: 데이터를 보는 하나의 방법론
	- Activation 관련 지표들 : AU / NAU (New AU) / Resurrection (AU\_IN7, AU\_IN14, ...) / Churn (AU\_OUT7, AU\_OUT14, ...)
	- 토스팀 전체의 관점에서 활용하기 어려움을 해결하기 위해 ODS 구축 전 ACT_TYPE이라는 코드체계(각 서비스들의 Activation에 대한 행위 정의) 생성
	- 분석가들은 해당 제품에서 측정하고자 하는 행위에 대해 ACT_TYPE을 정의하고 Active 로그추출 쿼리를 등록
	- 로그추출 쿼리를 기반으로 AU_LIST라는 통합 마트테이블 생성
	- 각 서비스마다 최초 Activation을 기록하는 AU_FIRST 마트테이블 생성
	- 중간 집계성 마트테이블을 ODS 데이터 영역에 저장되며, 여러 서비스의 Cross Activation 등 범용적으로 사용됨
	- 집계 및 workflow 관리는 Airflow 사용
     
## 효율적인 협업을 위한 도구
- DW에서 자동으로 집계하는것 외에도 직접 배치작업을 등록하고자하는 니즈가 있음
- Jenkins
	- 장점
		- 분석가들도 엔지니어의 도움없이 간단한 작업을 등록할 수 있을 정도로 사용이 쉬움
		- 다양한 플러그인이 제공됨
	- 단점
		- 관리기능이 부족
- 사용자와 Jenkins 사이에 Batch Centre라는 배치관리 시스템을 만들어서 문제 해결
	- Batch Centre는 Jenkins API를 이용하여 Jenkins 서버에 배치작업 등록/수정/삭제/중지 작업 등을 수행
	- 해당 job을 누가/언제/왜 만들었는지에 대한 정보는 따로 저장	- Git과 연계하여 형상관리도 지원
	- 작업 타이틀에 대해서만 검색이 되는 Jenkins의 단점을 보완하기 위해 작업 내용에 대해서도 검색이 되도록 검색기능 강화
	- 시스템에 과도한 부하를 일으킬 수 있는 heavy query 탐지 시 경고 알림이 뜨고 배치생성이 중지되는 기능도 추가
- Airlfow는 분석가보다는 엔지니어에 의해 사용되고 있으면, 간단한 job이 아닌 체계적인 workflow 설계가 필요한 부분에 사용되고 있음 
     
## 메타정보 관리
- 데이터 활용에 있어 중요한 부분
- 테이블 명세서와 같은 데이터를 설명하는 메타정보를 온라인으로 공유하는 것이 주요 기능
- Tag를 이용하여 사용자별 연관 테이블을 그룹핑하여 관리할 수 있음
- 데이터 영향도 파악 - 특정 테이블 변경 시에 해당 테이블의 데이터가 어디에서 어떻게 쓰이는지(ex. Jenkins) 미리 파악
- 테이블 칼럼 정보 등에 대한 질문을 보낼 수 있고 이에 대한 알림은 관련부서로 알림이 가도록 처리, 답변이 달린 경우는 별도로 저장해 추후 검색해볼 수 있도록 함
     
## 데이터 품질
- DQ시스템(Data Quality Management System)
- 초기 DW 시스템을 구축할 때는 DQ시스템까지는 도입하지 못할 수 있다
- 간단한 방법으로 DQ 시스템 흉내내기
	- 탐지 SQL을 입력받고 탐지 결과를 슬랙채널로 알려주는 프로그램 생성
	- Jenkins에 각각의 룰에 대응되는 job 등록
	- job이 많아질수록 관리에 어려움이 있음
- 데이터 품질 평가 기준
	- Completeness (완결성)
	- Uniqueness (유일성)
	- Validity (유효성)
	- Timeliness (시의적절성)
	- Accuracy (정확성)
	- Consistency (일관성)