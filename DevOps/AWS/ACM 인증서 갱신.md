# ACM 인증서 갱신
     
## ACM
- AWS에서 제공하는 무료 인증서
- 인증서는 주로 ELB나 CloudFront에서 https 통신을 위해 사용
	- ex. ELB > 리스너 > 리스너 ID가 `HTTPS : 443` 인것의 SSL 인증서
- ACM은 인증서 만료가 다가오면 자동으로 갱신하거나 이메일로 알림을 보냄
- ACM로 인증서를 요청할 때 검증방법을 DNS 검증과 이메일 검증 중 선택할 수 있음
	- 인증서 요청이 완료된 후 검증방법을 수정할 수 없음
	- 검증방법 수정을 위해서는 동일한 도메인에 새 인증서를 요청해서 이전 인증서에 연결된 리소스에 새 인증서도 연결해야 함
     
## ACM 검증방법

### DNS 검증
- DNS 검증을 선택할 경우 ACM에서 해당 도메인에 CNAME 레코드를 하나 생성해줌
- 생성된 CNAME 레코드는 도메인의 존재 증명 역할을 하는 고유한 key-value 쌍이 포함되어 있음
- 생성된 CNAME 레코드를 DNS 서버에 등록하고 검증 완료하면 됨
     
### 이메일 검증
- 도메인에 admin으로 등록된 이메일 계정으로 인증메일이 전송됨
- 전송된 메일을 확인하여 승인하고 검증 완료하면 됨
- 승인 전까진 해당 인증서는 `검증 대기 중` 상태
     
## ACM 인증서 갱신 방법

### DNS 검증 방식
- 인증서 만료 날짜 60일 전에 갱신 프로세스 진행됨
- 갱신 프로세스 중 초기 15일동안 인증서 자동 갱신을 시도하고, 이 기간동안 갱신 상태는 `Pending_Auto_Renewal`
- ACM이 자동으로 각 도메인 유효성 검사를 시도하고 아래 기준을 만족한다면 인증서 갱신
	- 인증서가 현재 AWS 서비스에 연결되어 사용되고 있는지(연결된 리소스가 존재하는지)
	- FQDN(정규화된 도메인 이름)이 포함된 유효한 DNS 레코드가 있는지
	- 필요한 CNAME 토큰이 존재하고 DNS 레코드에 접근할 수 있는지


### 이메일 검증 방식
- 인증서 만료 날짜 45일 전에 갱신 프로세스 진행됨
-  해당 도메인의 WHOIS 데이터베이스에 등록 및 공개로 되어있는 관리자의 주소(최대 5개)로 갱신 링크를 포함한 이메일 발송
-  도메인의 유효성 검사가 완료되고, 관리자가 갱신 메일을 확인 및 승인할 경우 인증서 갱신


## Notes
- https://velog.io/@rhgkssk1114/ACM-%EC%9D%B8%EC%A6%9D-%EB%B0%A9%EB%B2%95-%EB%B0%8F-%EC%9D%B8%EC%A6%9D%EC%84%9C-%EA%B0%B1%EC%8B%A0-%EB%B0%A9%EB%B2%95